import{ab as ae,r as p,S as te,a as D,o as le,a8 as Q,Z as z,a3 as s,$ as t,a0 as b,_ as o,a5 as U,a1 as x,a2 as f,ac as V,a4 as F,ad as B,a6 as N,af as oe,ae as j,ag as se,ah as q}from"./app-7S8I-rCH.js";import{Q as ie,a as re,b as I,c as $,d as ne,e as de}from"./QSpace-Bk5KCeEO.js";import{Q as ce}from"./QForm-Cr7Z-Fcn.js";import{u as ue}from"./use-quasar-BL6mzcax.js";import"./QList-C05wqgPJ.js";const ge={class:"q-pa-lg"},me={class:"row items-center justify-between q-mb-xl"},ve={class:"col-auto"},pe={class:"text-subtitle2 text-grey-8 q-mb-md"},fe={class:"row q-gutter-md"},be={class:"col-md-4 col-sm-6 col-xs-12"},ye={class:"col-md-3 col-sm-6 col-xs-12"},_e={class:"col-auto"},we={class:"row items-center q-gutter-sm"},Ce=["src"],xe={class:"text-weight-medium"},he={key:0,class:"text-caption text-grey-6"},Ve={class:"text-caption text-center q-mt-xs"},qe={class:"q-gutter-xs"},ke={class:"full-width row flex-center text-grey-5 q-gutter-sm q-pa-lg"},Ee={class:"text-h5"},Qe={class:"row q-gutter-lg"},ze={class:"col-md-8 col-xs-12"},Ue={class:"row items-center q-gutter-sm"},Ne={key:0,class:"row q-gutter-sm justify-end q-mt-lg"},Ie={__name:"AdminCategorias",setup($e){const v=ue(),A=p(!1),k=p(!1),d=p([]),E=p(!1),g=p("create"),h=p(null),y=p(""),_=p(null),n=te({name:"",slug:"",description:"",image:"",is_active:!0}),w=p({sortBy:"created_at",descending:!0,page:1,rowsPerPage:10,rowsNumber:0}),O=[{name:"name",label:"Categoría",field:"name",align:"left",sortable:!0,style:"width: 40%"},{name:"products_count",label:"Productos",field:"products_count",align:"center",sortable:!0,style:"width: 15%"},{name:"status",label:"Estado",field:"is_active",align:"center",sortable:!0,style:"width: 15%"},{name:"actions",label:"Acciones",field:"actions",align:"center",sortable:!1,style:"width: 20%"}],R=[{label:"Activas",value:1},{label:"Inactivas",value:0}],M=D(()=>{let l=[...d.value];if(y.value){const i=y.value.toLowerCase();l=l.filter(c=>{var u,m,r;return((u=c.name)==null?void 0:u.toLowerCase().includes(i))||((m=c.description)==null?void 0:m.toLowerCase().includes(i))||((r=c.slug)==null?void 0:r.toLowerCase().includes(i))})}_.value!==null&&(l=l.filter(i=>i.is_active===_.value));const e=(w.value.page-1)*w.value.rowsPerPage,a=e+w.value.rowsPerPage;return w.value.rowsNumber=l.length,l.slice(e,a)}),G=D(()=>{switch(g.value){case"create":return"Nueva Categoría";case"edit":return"Editar Categoría";case"view":return"Detalles de Categoría";default:return"Categoría"}});D(()=>d.value.filter(l=>!l.is_active).length);const Z=async()=>{var l;A.value=!0;try{const e=await q.get("/categories");(l=e.data)!=null&&l.data?d.value=e.data.data:Array.isArray(e.data)?d.value=e.data:d.value=[]}catch(e){console.error("Error loading categories:",e),d.value=[],v.notify({type:"negative",message:"Error al cargar las categorías",icon:"error"})}finally{A.value=!1}},H=()=>{n.name&&(n.slug=n.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))},S=(l,e=null)=>{g.value=l,h.value=e,l==="create"?Object.assign(n,{name:"",slug:"",description:"",image:"",is_active:!0}):e&&Object.assign(n,{name:e.name||"",slug:e.slug||"",description:e.description||"",image:e.image||"",is_active:e.is_active??!0}),E.value=!0},L=()=>{E.value=!1,h.value=null,k.value=!1},J=async()=>{var l,e,a,i,c,u,m;k.value=!0;try{let r;if(g.value==="create")r=await q.post("/categories",n),(l=r.data)!=null&&l.data&&d.value.unshift(r.data.data);else if(g.value==="edit"&&h.value){r=await q.put(`/categories/${h.value.id}`,n);const C=d.value.findIndex(T=>T.id===h.value.id);C!==-1&&((e=r.data)!=null&&e.data)&&(d.value[C]=r.data.data)}v.notify({type:"positive",message:((a=r.data)==null?void 0:a.message)||"Operación completada correctamente",icon:"check_circle"}),L()}catch(r){console.error("Error saving category:",r);let C="Error al guardar la categoría";(c=(i=r.response)==null?void 0:i.data)!=null&&c.message?C=r.response.data.message:(m=(u=r.response)==null?void 0:u.data)!=null&&m.errors&&(C=Object.values(r.response.data.errors).flat().join(", ")),v.notify({type:"negative",message:C,icon:"error"})}finally{k.value=!1}},K=async l=>{var e,a,i;l.updating=!0;try{const c=await q.patch(`/categories/${l.id}/toggle-active`),u=d.value.findIndex(m=>m.id===l.id);u!==-1&&(d.value[u].is_active=!d.value[u].is_active),v.notify({type:"positive",message:((e=c.data)==null?void 0:e.message)||"Estado actualizado correctamente",icon:"check_circle"})}catch(c){console.error("Error toggling category status:",c),v.notify({type:"negative",message:((i=(a=c.response)==null?void 0:a.data)==null?void 0:i.message)||"Error al cambiar el estado",icon:"error"})}finally{l.updating=!1}},W=l=>{v.dialog({title:"Confirmar eliminación",message:`¿Estás seguro de eliminar la categoría "${l.name}"?`,cancel:!0,persistent:!0,ok:{label:"Eliminar",color:"negative",icon:"delete"},cancel:{label:"Cancelar",color:"grey",flat:!0}}).onOk(async()=>{var a,i,c;const e=v.notify({type:"ongoing",message:"Eliminando categoría...",timeout:0,spinner:!0});try{const u=await q.delete(`/categories/${l.id}`),m=d.value.findIndex(r=>r.id===l.id);m!==-1&&d.value.splice(m,1),e(),v.notify({type:"positive",message:((a=u.data)==null?void 0:a.message)||"Categoría eliminada correctamente",icon:"check_circle"})}catch(u){console.error("Error deleting category:",u),e(),v.notify({type:"negative",message:((c=(i=u.response)==null?void 0:i.data)==null?void 0:c.message)||"Error al eliminar la categoría",icon:"error"})}})},P=()=>{console.log("Filtros aplicados:",{search:y.value,status:_.value})},X=()=>{y.value="",_.value=null},Y=l=>{w.value=l.pagination},ee=(l,e)=>l?l.length>e?l.slice(0,e)+"...":l:"";return le(async()=>{await Z()}),(l,e)=>(z(),Q("div",ge,[s("div",me,[e[9]||(e[9]=s("div",{class:"col"},[s("div",{class:"text-h5 text-weight-light text-primary q-mb-sm"}," Gestión de Categorías "),s("p",{class:"text-grey-6 text-body1"},"Administra el catálogo de categorías de tu tienda")],-1)),s("div",ve,[t(b,{color:"primary",icon:"bi-plus-circle",label:"Nueva Categoría",unelevated:"",size:"md",class:"q-px-lg",onClick:e[0]||(e[0]=a=>S("create"))})])]),t(F,{flat:"",bordered:"",class:"q-mb-lg shadow-2"},{default:o(()=>[t(U,null,{default:o(()=>[s("div",pe,[t(f,{name:"bi-search",class:"q-mr-xs"}),e[10]||(e[10]=x(" Filtros de búsqueda "))]),s("div",fe,[s("div",be,[t(V,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),placeholder:"Buscar categorías...",outlined:"",dense:"",clearable:"",onInput:P},{prepend:o(()=>[t(f,{name:"bi-search",color:"primary"})]),_:1},8,["modelValue"])]),s("div",ye,[t(ie,{modelValue:_.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>_.value=a),P],options:R,label:"Estado",outlined:"",dense:"",clearable:""},null,8,["modelValue"])]),s("div",_e,[t(b,{flat:"",icon:"bi-x-circle",label:"Limpiar",color:"grey-7",onClick:X})])])]),_:1})]),_:1}),t(F,{flat:"",bordered:"",class:"shadow-2"},{default:o(()=>[t(U,null,{default:o(()=>[t(re,{rows:M.value,columns:O,"row-key":"id",loading:A.value,flat:"",bordered:"",pagination:w.value,onRequest:Y,class:"category-table"},{"body-cell-name":o(a=>[t(I,{props:a},{default:o(()=>[s("div",we,[t(oe,{size:"30px",color:"primary","text-color":"white",icon:a.row.image?"bi-image":"bi-folder"},{default:o(()=>[a.row.image?(z(),Q("img",{key:0,src:a.row.image,alt:"Categoría"},null,8,Ce)):j("",!0)]),_:2},1032,["icon"]),s("div",null,[s("div",xe,N(a.row.name),1),a.row.description?(z(),Q("div",he,N(ee(a.row.description,60)),1)):j("",!0)])])]),_:2},1032,["props"])]),"body-cell-products_count":o(a=>[t(I,{props:a},{default:o(()=>[t(ne,{label:a.row.products_count||0,color:a.row.products_count>0?"positive":"grey-5","text-color":"white",size:"sm",icon:"bi-shop"},null,8,["label","color"])]),_:2},1032,["props"])]),"body-cell-status":o(a=>[t(I,{props:a},{default:o(()=>[t(B,{"model-value":a.row.is_active,"onUpdate:modelValue":i=>K(a.row),color:"positive",loading:a.row.updating,size:"lg"},null,8,["model-value","onUpdate:modelValue","loading"]),s("div",Ve,N(a.row.is_active?"Activa":"Inactiva"),1)]),_:2},1032,["props"])]),"body-cell-actions":o(a=>[t(I,{props:a},{default:o(()=>[s("div",qe,[t(b,{flat:"",round:"",icon:"bi-eye",size:"sm",color:"info",onClick:i=>S("view",a.row)},{default:o(()=>[t($,null,{default:o(()=>e[11]||(e[11]=[x("Ver detalles")])),_:1,__:[11]})]),_:2},1032,["onClick"]),t(b,{flat:"",round:"",icon:"bi-pencil",size:"sm",color:"primary",onClick:i=>S("edit",a.row)},{default:o(()=>[t($,null,{default:o(()=>e[12]||(e[12]=[x("Editar")])),_:1,__:[12]})]),_:2},1032,["onClick"]),t(b,{flat:"",round:"",icon:"bi-trash",size:"sm",color:"negative",onClick:i=>W(a.row)},{default:o(()=>[t($,null,{default:o(()=>e[13]||(e[13]=[x("Eliminar")])),_:1,__:[13]})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),"no-data":o(()=>[s("div",ke,[t(f,{size:"3em",name:"bi-tags"}),e[14]||(e[14]=s("div",{class:"text-center"},[s("div",{class:"text-h6"},"No se encontraron categorías"),s("div",{class:"text-body2"},"Intenta ajustar los filtros o agrega una nueva categoría")],-1))])]),_:1},8,["rows","loading","pagination"])]),_:1})]),_:1}),t(se,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=a=>E.value=a),persistent:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:o(()=>[t(F,{class:"full-width"},{default:o(()=>[t(U,{class:"row items-center q-pb-none bg-primary text-white"},{default:o(()=>[s("div",Ee,[t(f,{name:g.value==="create"?"bi-plus-circle":g.value==="edit"?"bi-pencil":"bi-eye",class:"q-mr-sm"},null,8,["name"]),x(" "+N(G.value),1)]),t(de),t(b,{icon:"bi-x",flat:"",round:"",dense:"",onClick:L})]),_:1}),t(U,{class:"q-pa-lg"},{default:o(()=>[s("div",Qe,[s("div",ze,[t(ce,{onSubmit:J,class:"q-gutter-md"},{default:o(()=>[t(V,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=a=>n.name=a),label:"Nombre de la categoría *",outlined:"",readonly:g.value==="view",rules:[a=>!!a||"El nombre es obligatorio"],onInput:H},{prepend:o(()=>[t(f,{name:"bi-type"})]),_:1},8,["modelValue","readonly","rules"]),t(V,{modelValue:n.slug,"onUpdate:modelValue":e[4]||(e[4]=a=>n.slug=a),label:"Slug (URL amigable)",outlined:"",readonly:"",hint:"Se genera automáticamente basado en el nombre"},{prepend:o(()=>[t(f,{name:"bi-link"})]),_:1},8,["modelValue"]),t(V,{modelValue:n.description,"onUpdate:modelValue":e[5]||(e[5]=a=>n.description=a),label:"Descripción",type:"textarea",outlined:"",rows:"4",readonly:g.value==="view",counter:"",maxlength:"1000"},{prepend:o(()=>[t(f,{name:"bi-textarea-resize"})]),_:1},8,["modelValue","readonly"]),t(V,{modelValue:n.image,"onUpdate:modelValue":e[6]||(e[6]=a=>n.image=a),label:"URL de imagen (opcional)",outlined:"",readonly:g.value==="view",hint:"URL de la imagen representativa de la categoría"},{prepend:o(()=>[t(f,{name:"bi-image"})]),_:1},8,["modelValue","readonly"]),s("div",Ue,[t(B,{modelValue:n.is_active,"onUpdate:modelValue":e[7]||(e[7]=a=>n.is_active=a),label:"Categoría activa",disable:g.value==="view",color:"positive"},null,8,["modelValue","disable"]),t(f,{name:"bi-question-circle",color:"grey-6",size:"sm"},{default:o(()=>[t($,null,{default:o(()=>e[15]||(e[15]=[x("Las categorías inactivas no se mostrarán en la tienda")])),_:1,__:[15]})]),_:1})]),g.value!=="view"?(z(),Q("div",Ne,[t(b,{flat:"",label:"Cancelar",color:"grey-7",onClick:L}),t(b,{type:"submit",label:g.value==="create"?"Crear Categoría":"Actualizar Categoría",color:"primary",loading:k.value,"icon-right":"save"},null,8,["label","loading"])])):j("",!0)]),_:1})])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},je=ae(Ie,[["__scopeId","data-v-9c5b3281"]]);export{je as default};
