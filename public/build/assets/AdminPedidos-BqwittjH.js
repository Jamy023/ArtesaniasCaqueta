import{ab as ie,r as u,S as ue,a as O,o as ce,a8 as P,Z as h,a3 as s,$ as t,_ as o,a5 as F,ac as r,a2 as p,a0 as q,a4 as A,a1 as y,a6 as i,a9 as me,aa as ve,Y as pe,ae as $,ag as fe,ah as L}from"./app-DyDhDduI.js";import{Q as M,a as j,b as v,c as S,d as be,e as ge}from"./QSpace-DvHyNBtp.js";import{u as _e}from"./use-quasar-BVTTWhNt.js";import"./QList-Bd_AvQtf.js";const ye={class:"row q-gutter-md"},we={class:"col-md-3 col-sm-6 col-xs-12"},xe={class:"col-md-3 col-sm-6 col-xs-12"},he={class:"col-md-2 col-sm-6 col-xs-12"},qe={class:"col-md-2 col-sm-6 col-xs-12"},Ce={class:"col-md-2 col-sm-6 col-xs-12"},Pe={class:"text-weight-medium text-primary"},Ve={class:"text-weight-medium"},De={class:"text-caption text-grey-6"},Ne={class:"text-weight-medium"},ke={class:"text-weight-medium"},Fe={class:"text-caption text-grey-6"},Qe={class:"text-caption"},Te={class:"q-gutter-xs"},Ee={class:"full-width row flex-center text-grey-5 q-gutter-sm"},Oe={class:"text-h5"},Ae={class:"row q-gutter-lg"},$e={class:"col-md-6 col-xs-12"},Se={class:"text-h6 text-primary q-mb-md"},Ie={class:"q-gutter-sm"},ze={class:"col-md-6 col-xs-12"},Ue={class:"text-h6 text-primary q-mb-md"},Be={key:0,class:"q-gutter-sm"},Le={class:"q-mt-lg"},Me={class:"text-h6 text-primary q-mb-md"},je={class:"text-weight-medium"},He={key:0,class:"row q-gutter-sm justify-end q-mt-xl"},Re={__name:"AdminPedidos",setup(Ge){const V=_e(),Q=u(!1),D=u(!1),c=u([]),N=u(!1),w=u("view"),n=u(null),f=u(""),b=u(null),g=u(""),_=u(""),m=ue({status:"",notes:""}),I=u({sortBy:"created_at",descending:!0,page:1,rowsPerPage:15,rowsNumber:0}),H=[{name:"order_number",label:"Número",field:"order_number",align:"left",sortable:!0},{name:"customer",label:"Cliente",field:l=>E(l),align:"left",sortable:!1},{name:"items",label:"Productos",field:"items",align:"center",sortable:!1},{name:"total",label:"Total",field:"total_amount",align:"right",sortable:!0},{name:"status",label:"Estado",field:"status",align:"center",sortable:!0},{name:"date",label:"Fecha",field:"created_at",align:"center",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center",sortable:!1}],R=[{name:"name",label:"Producto",field:"name",align:"left"},{name:"quantity",label:"Cantidad",field:"quantity",align:"center"},{name:"price",label:"Precio Unitario",field:"price",align:"right"},{name:"subtotal",label:"Subtotal",field:l=>l.price*l.quantity,align:"right"}],G=[{label:"Todos los estados",value:null},{label:"Pendiente",value:"pending"},{label:"Pagado",value:"paid"},{label:"Fallido",value:"failed"},{label:"Cancelado",value:"cancelled"}],Y=[{label:"Pendiente",value:"pending"},{label:"Pagado",value:"paid"},{label:"Fallido",value:"failed"},{label:"Cancelado",value:"cancelled"}],Z=O(()=>{let l=[...c.value];if(f.value){const a=f.value.toLowerCase();l=l.filter(e=>e.order_number.toLowerCase().includes(a))}if(b.value&&(l=l.filter(a=>a.status===b.value)),g.value){const a=new Date(g.value);l=l.filter(e=>new Date(e.created_at)>=a)}if(_.value){const a=new Date(_.value);a.setHours(23,59,59,999),l=l.filter(e=>new Date(e.created_at)<=a)}return l}),J=O(()=>f.value||b.value||g.value||_.value),K=O(()=>w.value==="edit"?"Editar Pedido":"Detalles del Pedido"),W=async()=>{var l,a;Q.value=!0;try{const e=await L.get("/admin/orders");(l=e.data)!=null&&l.orders?c.value=e.data.orders:Array.isArray(e.data)?c.value=e.data:c.value=[],V.notify({type:"positive",message:`${c.value.length} pedidos cargados correctamente`})}catch(e){console.error("Error loading orders:",e);let d="Error al cargar pedidos";e.response?e.response.status===401?d="No tienes permisos para acceder a esta información":e.response.status===403?d="Acceso denegado":(a=e.response.data)!=null&&a.message&&(d=e.response.data.message):e.request&&(d="Error de conexión con el servidor"),V.notify({type:"negative",message:d}),c.value=[]}finally{Q.value=!1}},z=(l,a=null)=>{w.value=l,n.value=a,a&&(m.status=a.status,m.notes=a.notes||""),N.value=!0},T=()=>{N.value=!1,n.value=null,D.value=!1},X=async()=>{var l,a,e;if(n.value){D.value=!0;try{const d=await L.patch(`/admin/orders/${n.value.id}/status`,{status:m.status,notes:m.notes}),x=c.value.findIndex(re=>re.id===n.value.id);x!==-1&&(c.value[x]={...c.value[x],...m}),V.notify({type:"positive",message:((l=d.data)==null?void 0:l.message)||"Pedido actualizado correctamente",icon:"check_circle"}),T()}catch(d){console.error("Error saving order:",d);let x="Error al actualizar el pedido";(e=(a=d.response)==null?void 0:a.data)!=null&&e.message&&(x=d.response.data.message),V.notify({type:"negative",message:x,icon:"error"})}finally{D.value=!1}}},k=()=>{console.log("Filtros aplicados:",{search:f.value,status:b.value,dateFrom:g.value,dateTo:_.value})},ee=()=>{f.value="",b.value=null,g.value="",_.value=""},ae=l=>{I.value=l.pagination},C=l=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(l),U=l=>new Date(l).toLocaleDateString("es-CO"),B=l=>new Date(l).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"}),le=l=>({pending:"Pendiente",paid:"Pagado",failed:"Fallido",cancelled:"Cancelado"})[l]||l,te=l=>({pending:"warning",paid:"positive",failed:"negative",cancelled:"grey"})[l]||"grey",E=l=>{if(!l.customer_data)return"No disponible";const a=l.customer_data.nombre||"",e=l.customer_data.apellido||"";return`${a} ${e}`.trim()||"No disponible"},oe=l=>{var a;return((a=l.customer_data)==null?void 0:a.email)||"No disponible"},se=l=>{if(!l.customer_data)return"No disponible";const a=l.customer_data.direccion||"",e=l.customer_data.ciudad||"",d=l.customer_data.departamento||"";return`${a}, ${e}, ${d}`.replace(/^,\s*|,\s*$/g,"")||"No disponible"},de=l=>Array.isArray(l)?l.reduce((a,e)=>a+(e.quantity||0),0):0,ne=l=>l.status!=="paid";return ce(()=>{W()}),(l,a)=>(h(),P("div",null,[a[13]||(a[13]=s("div",{class:"row items-center justify-between q-mb-lg"},[s("div",{class:"col"},[s("br"),s("br"),s("h4",{class:"text-h4 q-my-none"},"Gestión de Pedidos"),s("p",{class:"text-grey-6"},"Administra los pedidos realizados por los clientes")])],-1)),t(A,{flat:"",bordered:"",class:"q-mb-md"},{default:o(()=>[t(F,null,{default:o(()=>[s("div",ye,[s("div",we,[t(r,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=e=>f.value=e),placeholder:"Buscar por número de pedido...",outlined:"",dense:"",clearable:"",onInput:k},{prepend:o(()=>[t(p,{name:"bi-search"})]),_:1},8,["modelValue"])]),s("div",xe,[t(M,{modelValue:b.value,"onUpdate:modelValue":[a[1]||(a[1]=e=>b.value=e),k],options:G,placeholder:"Todos los estados",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue"])]),s("div",he,[t(r,{modelValue:g.value,"onUpdate:modelValue":[a[2]||(a[2]=e=>g.value=e),k],type:"date",label:"Desde",outlined:"",dense:""},{prepend:o(()=>[t(p,{name:"bi-calendar-date"})]),_:1},8,["modelValue"])]),s("div",qe,[t(r,{modelValue:_.value,"onUpdate:modelValue":[a[3]||(a[3]=e=>_.value=e),k],type:"date",label:"Hasta",outlined:"",dense:""},{prepend:o(()=>[t(p,{name:"bi-calendar-date"})]),_:1},8,["modelValue"])]),s("div",Ce,[t(q,{flat:"",icon:"clear",label:"Limpiar",onClick:ee,disable:!J.value},null,8,["disable"])])])]),_:1})]),_:1}),t(A,{flat:"",bordered:""},{default:o(()=>[t(F,null,{default:o(()=>[t(j,{rows:Z.value,columns:H,"row-key":"id",loading:Q.value,flat:"",bordered:"",pagination:I.value,onRequest:ae},{"body-cell-order_number":o(e=>[t(v,{props:e},{default:o(()=>[s("div",Pe,i(e.row.order_number),1)]),_:2},1032,["props"])]),"body-cell-customer":o(e=>[t(v,{props:e},{default:o(()=>[s("div",null,[s("div",Ve,i(E(e.row)),1),s("div",De,i(oe(e.row)),1)])]),_:2},1032,["props"])]),"body-cell-total":o(e=>[t(v,{props:e},{default:o(()=>[s("span",Ne,i(C(e.row.total_amount)),1)]),_:2},1032,["props"])]),"body-cell-status":o(e=>[t(v,{props:e},{default:o(()=>[t(be,{label:le(e.row.status),color:te(e.row.status),"text-color":"white",size:"sm"},null,8,["label","color"])]),_:2},1032,["props"])]),"body-cell-date":o(e=>[t(v,{props:e},{default:o(()=>[s("div",null,[s("div",ke,i(U(e.row.created_at)),1),s("div",Fe,i(B(e.row.created_at)),1)])]),_:2},1032,["props"])]),"body-cell-items":o(e=>[t(v,{props:e},{default:o(()=>[s("div",Qe,i(de(e.row.items))+" producto(s) ",1),t(S,null,{default:o(()=>[(h(!0),P(me,null,ve(e.row.items,d=>(h(),P("div",{key:d.id,class:"q-py-xs"},i(d.quantity)+"x "+i(d.name)+" - "+i(C(d.price)),1))),128))]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-actions":o(e=>[t(v,{props:e},{default:o(()=>[s("div",Te,[t(q,{flat:"",round:"",icon:"bi-eye",size:"sm",color:"info",onClick:d=>z("view",e.row)},{default:o(()=>[t(S,null,{default:o(()=>a[7]||(a[7]=[y("Ver detalles")])),_:1,__:[7]})]),_:2},1032,["onClick"]),t(q,{flat:"",round:"",icon:"bi-pencil",size:"sm",color:"primary",onClick:d=>z("edit",e.row),disable:!ne(e.row)},{default:o(()=>[t(S,null,{default:o(()=>a[8]||(a[8]=[y("Editar estado")])),_:1,__:[8]})]),_:2},1032,["onClick","disable"])])]),_:2},1032,["props"])]),"no-data":o(()=>[s("div",Ee,[t(p,{size:"2em",name:"receipt_long"}),a[9]||(a[9]=s("span",null,"No se encontraron pedidos",-1))])]),_:1},8,["rows","loading","pagination"])]),_:1})]),_:1}),t(fe,{modelValue:N.value,"onUpdate:modelValue":a[6]||(a[6]=e=>N.value=e),persistent:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:o(()=>[t(A,{class:"full-width",style:{"max-width":"800px"}},{default:o(()=>[t(F,{class:"row items-center q-pb-none bg-primary text-white"},{default:o(()=>[s("div",Oe,[t(p,{name:w.value==="edit"?"bi-pencil":"bi-eye",class:"q-mr-sm"},null,8,["name"]),y(" "+i(K.value),1)]),t(ge),t(q,{icon:"bi-x",flat:"",round:"",dense:"",onClick:T})]),_:1}),n.value?(h(),pe(F,{key:0,class:"q-pa-lg"},{default:o(()=>[s("div",Ae,[s("div",$e,[s("div",Se,[t(p,{name:"receipt",class:"q-mr-sm"}),a[10]||(a[10]=y(" Información del Pedido "))]),s("div",Ie,[t(r,{"model-value":n.value.order_number,label:"Número de Pedido",outlined:"",readonly:""},null,8,["model-value"]),t(r,{"model-value":C(n.value.total_amount),label:"Total",outlined:"",readonly:""},null,8,["model-value"]),t(M,{modelValue:m.status,"onUpdate:modelValue":a[4]||(a[4]=e=>m.status=e),options:Y,label:"Estado",outlined:"","emit-value":"","map-options":"",readonly:w.value==="view"},null,8,["modelValue","readonly"]),t(r,{modelValue:m.notes,"onUpdate:modelValue":a[5]||(a[5]=e=>m.notes=e),label:"Notas administrativas",type:"textarea",rows:"3",outlined:"",readonly:w.value==="view"},null,8,["modelValue","readonly"]),t(r,{"model-value":n.value.payment_method||"No especificado",label:"Método de Pago",outlined:"",readonly:""},null,8,["model-value"]),t(r,{"model-value":U(n.value.created_at)+" "+B(n.value.created_at),label:"Fecha del Pedido",outlined:"",readonly:""},null,8,["model-value"])])]),s("div",ze,[s("div",Ue,[t(p,{name:"person",class:"q-mr-sm"}),a[11]||(a[11]=y(" Información del Cliente "))]),n.value.customer_data?(h(),P("div",Be,[t(r,{"model-value":E(n.value),label:"Nombre Completo",outlined:"",readonly:""},null,8,["model-value"]),t(r,{"model-value":n.value.customer_data.email,label:"Email",outlined:"",readonly:""},null,8,["model-value"]),t(r,{"model-value":n.value.customer_data.telefono||"No especificado",label:"Teléfono",outlined:"",readonly:""},null,8,["model-value"]),t(r,{"model-value":(n.value.customer_data.tipo_documento||"")+" "+(n.value.customer_data.documento||""),label:"Documento",outlined:"",readonly:""},null,8,["model-value"]),t(r,{"model-value":se(n.value),label:"Dirección",outlined:"",readonly:""},null,8,["model-value"])])):$("",!0)])]),s("div",Le,[s("div",Me,[t(p,{name:"shopping_cart",class:"q-mr-sm"}),a[12]||(a[12]=y(" Productos del Pedido "))]),t(j,{rows:n.value.items||[],columns:R,"row-key":"id",flat:"",bordered:"","hide-pagination":"","rows-per-page-options":[0]},{"body-cell-price":o(e=>[t(v,{props:e},{default:o(()=>[y(i(C(e.row.price)),1)]),_:2},1032,["props"])]),"body-cell-subtotal":o(e=>[t(v,{props:e},{default:o(()=>[s("span",je,i(C(e.row.price*e.row.quantity)),1)]),_:2},1032,["props"])]),_:1},8,["rows"])]),w.value==="edit"?(h(),P("div",He,[t(q,{flat:"",label:"Cancelar",color:"grey-7",onClick:T}),t(q,{label:"Actualizar Pedido",color:"primary",loading:D.value,"icon-right":"save",onClick:X},null,8,["loading"])])):$("",!0)]),_:1})):$("",!0)]),_:1})]),_:1},8,["modelValue"])]))}},We=ie(Re,[["__scopeId","data-v-8fdb6432"]]);export{We as default};
