import{ab as xe,r as g,S as Ve,a as S,o as qe,a8 as b,Z as p,a3 as o,$ as t,a0 as y,_ as s,a5 as A,ac as w,a2 as c,a4 as j,a1 as h,ad as Y,a6 as M,Y as Z,ae as U,af as Ce,a9 as Pe,aa as Ie,ag as Ue,ah as C}from"./app-6YsqTXnk.js";import{Q as G,a as Ee,b as P,c as $,d as H,e as Se,f as Qe}from"./QForm-BEkzOPTV.js";import{u as ze}from"./use-quasar-6Nc55FC6.js";import"./QList-aTwoovDj.js";const Ae={class:"row items-center justify-between q-mb-lg"},Me={class:"col-auto"},$e={class:"row q-gutter-md"},Ne={class:"col-md-4 col-sm-6 col-xs-12"},De={class:"col-md-3 col-sm-6 col-xs-12"},Fe={class:"col-md-3 col-sm-6 col-xs-12"},Te={class:"col-md-2 col-sm-6 col-xs-12"},Oe=["src","alt"],Le={class:"text-weight-medium"},Be={key:0,class:"text-caption text-grey-6"},je={key:1,class:"text-grey-5"},Ge={class:"text-weight-medium"},We={class:"q-gutter-xs"},Re={class:"full-width row flex-center text-grey-5 q-gutter-sm"},Ke={class:"text-h5"},Ye={class:"row q-gutter-lg"},Ze={class:"col-md-8 col-xs-12"},He={class:"text-h6 text-primary q-mb-md"},Je={class:"text-h6 text-primary q-mb-md q-mt-lg"},Xe={class:"row q-gutter-md"},ea={class:"col-md-6 col-xs-12"},aa={class:"col-md-6 col-xs-12"},la={class:"text-h6 text-primary q-mb-md q-mt-lg"},ta={class:"row q-gutter-md"},oa={class:"col-md-4 col-xs-12"},sa={class:"col-md-4 col-xs-12"},ia={class:"col-md-4 col-xs-12"},ra={class:"row items-center q-gutter-sm q-mt-md"},na={key:0,class:"row q-gutter-sm justify-end q-mt-xl"},da={class:"col-md-4 col-xs-12"},ua={class:"text-h6 text-primary q-mb-md"},ca={class:"q-mb-lg"},ma={class:"image-upload-container"},ga={key:0,class:"image-preview"},pa=["src"],va={key:0,class:"image-overlay"},ya={key:1,class:"image-placeholder"},fa={class:"gallery-container"},ba=["src"],_a={key:0,class:"image-overlay"},wa={key:0,class:"gallery-add"},ha={__name:"AdminProductos",setup(ka){const f=ze(),N=g(!1),Q=g(!1),m=g([]),I=g([]),z=g(!1),n=g("create"),E=g(null),W=g(null),R=g(null),x=g(""),V=g(null),q=g(null),i=Ve({name:"",slug:"",description:"",price:0,stock:0,sku:"",dimensions:{width:null,height:null,depth:null},main_image:"",gallery:[],category_id:null,is_active:!0}),D=g({sortBy:"created_at",descending:!0,page:1,rowsPerPage:10,rowsNumber:0}),J=[{name:"image",label:"Imagen",field:"main_image",align:"center",sortable:!1},{name:"name",label:"Producto",field:"name",align:"left",sortable:!0},{name:"category",label:"Categoría",field:l=>{var e;return((e=l.category)==null?void 0:e.name)||""},align:"left",sortable:!0},{name:"price",label:"Precio",field:"price",align:"right",sortable:!0},{name:"stock",label:"Stock",field:"stock",align:"center",sortable:!0},{name:"status",label:"Estado",field:"is_active",align:"center",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center",sortable:!1}],X=S(()=>[{label:"Todas las categorías",value:null},...I.value.map(l=>({label:l.name,value:l.id}))]),ee=S(()=>I.value.map(l=>({label:l.name,value:l.id}))),ae=[{label:"Todos los estados",value:null},{label:"Activos",value:!0},{label:"Inactivos",value:!1}],le=S(()=>{let l=[...m.value];if(x.value){const e=x.value.toLowerCase();l=l.filter(a=>a.name.toLowerCase().includes(e)||a.description&&a.description.toLowerCase().includes(e))}return V.value&&(l=l.filter(e=>e.category_id===V.value)),q.value!==null&&(l=l.filter(e=>e.is_active===q.value)),l}),te=S(()=>x.value||V.value||q.value!==null),oe=S(()=>{switch(n.value){case"create":return"Nuevo Producto";case"edit":return"Editar Producto";case"view":return"Detalles del Producto";default:return"Producto"}}),se=async()=>{var l,e;N.value=!0;try{const a=await C.get("/products?admin_view=1");(l=a.data)!=null&&l.data?(m.value=a.data.data,a.data.total&&(D.value.rowsNumber=a.data.total)):Array.isArray(a.data)?m.value=a.data:m.value=[],f.notify({type:"positive",message:`${m.value.length} productos cargados correctamente`})}catch(a){console.error("Error loading products:",a);let r="Error al cargar productos";a.response?a.response.status===401?r="No tienes permisos para acceder a esta información":a.response.status===403?r="Acceso denegado":(e=a.response.data)!=null&&e.message&&(r=a.response.data.message):a.request?r="Error de conexión con el servidor":r=a.message,f.notify({type:"negative",message:r}),m.value=[]}finally{N.value=!1}},ie=async()=>{var l;try{const e=await C.get("/categories");(l=e.data)!=null&&l.data?I.value=e.data.data:Array.isArray(e.data)?I.value=e.data:I.value=[]}catch(e){console.error("Error loading categories:",e),I.value=[]}},re=()=>{i.name&&(i.slug=i.name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim("-"))},F=(l,e=null)=>{n.value=l,E.value=e,l==="create"?Object.assign(i,{name:"",slug:"",description:"",price:0,stock:0,sku:"",dimensions:{width:null,height:null,depth:null},main_image:"",gallery:[],category_id:null,is_active:!0}):e&&Object.assign(i,{name:e.name||"",slug:e.slug||"",description:e.description||"",price:e.price||0,stock:e.stock||0,sku:e.sku||"",dimensions:e.dimensions||{width:null,height:null,depth:null},main_image:e.main_image||"",gallery:e.gallery||[],category_id:e.category_id||null,is_active:e.is_active??!0}),z.value=!0},T=()=>{z.value=!1,E.value=null,Q.value=!1},ne=async()=>{var l,e,a,r,v,u,_;Q.value=!0;try{let d;const k={...i,dimensions:i.dimensions.width||i.dimensions.height||i.dimensions.depth?i.dimensions:null};if(n.value==="create")d=await C.post("/products",k),(l=d.data)!=null&&l.product&&m.value.unshift(d.data.product);else if(n.value==="edit"&&E.value){d=await C.put(`/products/${E.value.id}`,k);const B=m.value.findIndex(ke=>ke.id===E.value.id);B!==-1&&((e=d.data)!=null&&e.product)&&(m.value[B]=d.data.product)}f.notify({type:"positive",message:((a=d.data)==null?void 0:a.message)||"Operación completada correctamente",icon:"check_circle"}),T()}catch(d){console.error("Error saving product:",d);let k="Error al guardar el producto";(v=(r=d.response)==null?void 0:r.data)!=null&&v.message?k=d.response.data.message:(_=(u=d.response)==null?void 0:u.data)!=null&&_.errors&&(k=Object.values(d.response.data.errors).flat().join(", ")),f.notify({type:"negative",message:k,icon:"error"})}finally{Q.value=!1}},de=()=>{var l;(l=W.value)==null||l.click()},ue=()=>{var l;(l=R.value)==null||l.click()},ce=async l=>{const e=l.target.files[0];if(e){const a=await K(e);a&&(i.main_image=a)}},me=async l=>{const e=Array.from(l.target.files);for(const a of e){const r=await K(a);r&&i.gallery.push(r)}},K=async l=>{const e=new FormData;e.append("image",l);try{return(await C.post("/upload-product-image",e,{headers:{"Content-Type":"multipart/form-data"}})).data.path}catch(a){return console.error("Error uploading image:",a),f.notify({type:"negative",message:"Error al subir la imagen"}),null}},ge=()=>{i.main_image=""},pe=l=>{i.gallery.splice(l,1)},ve=async l=>{var e,a,r;l.updating=!0;try{const v=await C.patch(`/products/${l.id}/toggle-active`),u=m.value.findIndex(d=>d.id===l.id);u!==-1&&(m.value[u].is_active=!m.value[u].is_active);const _=((e=v.data)==null?void 0:e.message)||`Producto ${m.value[u].is_active?"activado":"desactivado"} correctamente`;f.notify({type:"positive",message:_})}catch(v){console.error("Error toggling product status:",v);let u="Error al cambiar el estado del producto";(r=(a=v.response)==null?void 0:a.data)!=null&&r.message&&(u=v.response.data.message),f.notify({type:"negative",message:u})}finally{l.updating=!1}},ye=l=>{f.dialog({title:"Confirmar eliminación",message:`¿Estás seguro de eliminar el producto "${l.name}"?`,cancel:!0,persistent:!0,ok:{label:"Eliminar",color:"negative",icon:"delete"},cancel:{label:"Cancelar",color:"grey",flat:!0}}).onOk(async()=>{var a,r,v;const e=f.notify({type:"ongoing",message:"Eliminando producto...",timeout:0,spinner:!0});try{const u=await C.delete(`/products/${l.id}`),_=m.value.findIndex(k=>k.id===l.id);_!==-1&&m.value.splice(_,1),e();const d=((a=u.data)==null?void 0:a.message)||"Producto eliminado correctamente";f.notify({type:"positive",message:d,icon:"check_circle"})}catch(u){console.error("Error deleting product:",u),e();let _="Error al eliminar el producto";(v=(r=u.response)==null?void 0:r.data)!=null&&v.message&&(_=u.response.data.message),f.notify({type:"negative",message:_,icon:"error"})}})},O=()=>{console.log("Filtros aplicados:",{search:x.value,category:V.value,status:q.value})},fe=()=>{x.value="",V.value=null,q.value=null},be=l=>{D.value=l.pagination},_e=l=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(l),L=l=>l?l.startsWith("http")?l:l.startsWith("public/")?"/storage/"+l.replace("public/",""):l.startsWith("storage/app/public/")?"/storage/"+l.replace("storage/app/public/",""):l.startsWith("products/")?"/storage/"+l:l:"/img/logo.png",we=l=>l===0?"negative":l<=5?"warning":"positive",he=(l,e)=>l?l.length>e?l.slice(0,e)+"...":l:"";return qe(async()=>{await Promise.all([se(),ie()])}),(l,e)=>(p(),b("div",null,[o("div",Ae,[e[16]||(e[16]=o("div",{class:"col"},[o("br"),o("br"),o("h4",{class:"text-h4 q-my-none"},"Gestión de Productos"),o("p",{class:"text-grey-6"},"Administra el catálogo de productos de tu tienda")],-1)),o("div",Me,[t(y,{color:"primary",icon:"add_circle",label:"Nuevo Producto",unelevated:"",size:"md",class:"q-px-lg",onClick:e[0]||(e[0]=a=>F("create"))})])]),t(j,{flat:"",bordered:"",class:"q-mb-md"},{default:s(()=>[t(A,null,{default:s(()=>[o("div",$e,[o("div",Ne,[t(w,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),placeholder:"Buscar productos...",outlined:"",dense:"",clearable:"",onInput:O},{prepend:s(()=>[t(c,{name:"search"})]),_:1},8,["modelValue"])]),o("div",De,[t(G,{modelValue:V.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>V.value=a),O],options:X.value,placeholder:"Todas las categorías",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue","options"])]),o("div",Fe,[t(G,{modelValue:q.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>q.value=a),O],options:ae,placeholder:"Todos los estados",outlined:"",dense:"",clearable:"","emit-value":"","map-options":""},null,8,["modelValue"])]),o("div",Te,[t(y,{flat:"",icon:"clear",label:"Limpiar",onClick:fe,disable:!te.value},null,8,["disable"])])])]),_:1})]),_:1}),t(j,{flat:"",bordered:""},{default:s(()=>[t(A,null,{default:s(()=>[t(Ee,{rows:le.value,columns:J,"row-key":"id",loading:N.value,flat:"",bordered:"",pagination:D.value,onRequest:be},{"body-cell-image":s(a=>[t(P,{props:a},{default:s(()=>[t(Ce,{size:"40px",square:""},{default:s(()=>[o("img",{src:L(a.row.main_image),alt:a.row.name,style:{"object-fit":"cover"}},null,8,Oe)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-name":s(a=>[t(P,{props:a},{default:s(()=>[o("div",null,[o("div",Le,M(a.row.name),1),a.row.description?(p(),b("div",Be,M(he(a.row.description,50)),1)):U("",!0)])]),_:2},1032,["props"])]),"body-cell-category":s(a=>[t(P,{props:a},{default:s(()=>[a.row.category?(p(),Z(H,{key:0,label:a.row.category.name,color:"primary","text-color":"white",size:"sm"},null,8,["label"])):(p(),b("span",je,"Sin categoría"))]),_:2},1032,["props"])]),"body-cell-price":s(a=>[t(P,{props:a},{default:s(()=>[o("span",Ge,M(_e(a.row.price)),1)]),_:2},1032,["props"])]),"body-cell-stock":s(a=>[t(P,{props:a},{default:s(()=>[t(H,{label:a.row.stock,color:we(a.row.stock),"text-color":"white",size:"sm"},null,8,["label","color"])]),_:2},1032,["props"])]),"body-cell-status":s(a=>[t(P,{props:a},{default:s(()=>[t(Y,{"model-value":a.row.is_active,"onUpdate:modelValue":r=>ve(a.row),color:"positive",loading:a.row.updating},null,8,["model-value","onUpdate:modelValue","loading"])]),_:2},1032,["props"])]),"body-cell-actions":s(a=>[t(P,{props:a},{default:s(()=>[o("div",We,[t(y,{flat:"",round:"",icon:"visibility",size:"sm",color:"info",onClick:r=>F("view",a.row)},{default:s(()=>[t($,null,{default:s(()=>e[17]||(e[17]=[h("Ver detalles")])),_:1,__:[17]})]),_:2},1032,["onClick"]),t(y,{flat:"",round:"",icon:"edit",size:"sm",color:"primary",onClick:r=>F("edit",a.row)},{default:s(()=>[t($,null,{default:s(()=>e[18]||(e[18]=[h("Editar")])),_:1,__:[18]})]),_:2},1032,["onClick"]),t(y,{flat:"",round:"",icon:"delete",size:"sm",color:"negative",onClick:r=>ye(a.row)},{default:s(()=>[t($,null,{default:s(()=>e[19]||(e[19]=[h("Eliminar")])),_:1,__:[19]})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),"no-data":s(()=>[o("div",Re,[t(c,{size:"2em",name:"inventory_2"}),e[20]||(e[20]=o("span",null,"No se encontraron productos",-1))])]),_:1},8,["rows","loading","pagination"])]),_:1})]),_:1}),t(Ue,{modelValue:z.value,"onUpdate:modelValue":e[15]||(e[15]=a=>z.value=a),persistent:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:s(()=>[t(j,{class:"full-width"},{default:s(()=>[t(A,{class:"row items-center q-pb-none bg-primary text-white"},{default:s(()=>[o("div",Ke,[t(c,{name:n.value==="create"?"add_circle":n.value==="edit"?"edit":"visibility",class:"q-mr-sm"},null,8,["name"]),h(" "+M(oe.value),1)]),t(Se),t(y,{icon:"close",flat:"",round:"",dense:"",onClick:T})]),_:1}),t(A,{class:"q-pa-lg"},{default:s(()=>[o("div",Ye,[o("div",Ze,[t(Qe,{onSubmit:ne,class:"q-gutter-md"},{default:s(()=>[o("div",He,[t(c,{name:"info",class:"q-mr-sm"}),e[21]||(e[21]=h(" Información Básica "))]),t(w,{modelValue:i.name,"onUpdate:modelValue":e[4]||(e[4]=a=>i.name=a),label:"Nombre del producto *",outlined:"",readonly:n.value==="view",rules:[a=>!!a||"El nombre es obligatorio"],onInput:re},{prepend:s(()=>[t(c,{name:"title"})]),_:1},8,["modelValue","readonly","rules"]),t(w,{modelValue:i.slug,"onUpdate:modelValue":e[5]||(e[5]=a=>i.slug=a),label:"Slug (URL amigable)",outlined:"",readonly:"",hint:"Se genera automáticamente basado en el nombre"},{prepend:s(()=>[t(c,{name:"link"})]),_:1},8,["modelValue"]),t(w,{modelValue:i.description,"onUpdate:modelValue":e[6]||(e[6]=a=>i.description=a),label:"Descripción *",type:"textarea",outlined:"",rows:"4",readonly:n.value==="view",rules:[a=>!!a||"La descripción es obligatoria"],counter:"",maxlength:"2000"},{prepend:s(()=>[t(c,{name:"description"})]),_:1},8,["modelValue","readonly","rules"]),t(G,{modelValue:i.category_id,"onUpdate:modelValue":e[7]||(e[7]=a=>i.category_id=a),options:ee.value,label:"Categoría *",outlined:"","emit-value":"","map-options":"",readonly:n.value==="view",rules:[a=>!!a||"La categoría es obligatoria"]},{prepend:s(()=>[t(c,{name:"category"})]),_:1},8,["modelValue","options","readonly","rules"]),o("div",Je,[t(c,{name:"attach_money",class:"q-mr-sm"}),e[22]||(e[22]=h(" Precio y Stock "))]),o("div",Xe,[o("div",ea,[t(w,{modelValue:i.price,"onUpdate:modelValue":e[8]||(e[8]=a=>i.price=a),modelModifiers:{number:!0},label:"Precio *",type:"number",min:"0",step:"0.01",outlined:"",readonly:n.value==="view",rules:[a=>a>=0||"El precio debe ser mayor o igual a 0"],prefix:"$"},{prepend:s(()=>[t(c,{name:"monetization_on"})]),_:1},8,["modelValue","readonly","rules"])]),o("div",aa,[t(w,{modelValue:i.stock,"onUpdate:modelValue":e[9]||(e[9]=a=>i.stock=a),modelModifiers:{number:!0},label:"Stock *",type:"number",min:"0",outlined:"",readonly:n.value==="view",rules:[a=>a>=0||"El stock debe ser mayor o igual a 0"]},{prepend:s(()=>[t(c,{name:"inventory"})]),_:1},8,["modelValue","readonly","rules"])])]),t(w,{modelValue:i.sku,"onUpdate:modelValue":e[10]||(e[10]=a=>i.sku=a),label:"SKU (opcional)",outlined:"",readonly:n.value==="view",hint:"Código único del producto"},{prepend:s(()=>[t(c,{name:"qr_code"})]),_:1},8,["modelValue","readonly"]),o("div",la,[t(c,{name:"straighten",class:"q-mr-sm"}),e[23]||(e[23]=h(" Dimensiones (opcional) "))]),o("div",ta,[o("div",oa,[t(w,{modelValue:i.dimensions.width,"onUpdate:modelValue":e[11]||(e[11]=a=>i.dimensions.width=a),modelModifiers:{number:!0},label:"Ancho (cm)",type:"number",min:"0",step:"0.1",outlined:"",readonly:n.value==="view"},null,8,["modelValue","readonly"])]),o("div",sa,[t(w,{modelValue:i.dimensions.height,"onUpdate:modelValue":e[12]||(e[12]=a=>i.dimensions.height=a),modelModifiers:{number:!0},label:"Alto (cm)",type:"number",min:"0",step:"0.1",outlined:"",readonly:n.value==="view"},null,8,["modelValue","readonly"])]),o("div",ia,[t(w,{modelValue:i.dimensions.depth,"onUpdate:modelValue":e[13]||(e[13]=a=>i.dimensions.depth=a),modelModifiers:{number:!0},label:"Profundidad (cm)",type:"number",min:"0",step:"0.1",outlined:"",readonly:n.value==="view"},null,8,["modelValue","readonly"])])]),o("div",ra,[t(Y,{modelValue:i.is_active,"onUpdate:modelValue":e[14]||(e[14]=a=>i.is_active=a),label:"Producto activo",disable:n.value==="view",color:"positive"},null,8,["modelValue","disable"]),t(c,{name:"help_outline",color:"grey-6",size:"sm"},{default:s(()=>[t($,null,{default:s(()=>e[24]||(e[24]=[h("Los productos inactivos no se mostrarán en la tienda")])),_:1,__:[24]})]),_:1})]),n.value!=="view"?(p(),b("div",na,[t(y,{flat:"",label:"Cancelar",color:"grey-7",onClick:T}),t(y,{type:"submit",label:n.value==="create"?"Crear Producto":"Actualizar Producto",color:"primary",loading:Q.value,"icon-right":"save"},null,8,["label","loading"])])):U("",!0)]),_:1})]),o("div",da,[o("div",ua,[t(c,{name:"image",class:"q-mr-sm"}),e[25]||(e[25]=h(" Imágenes del Producto "))]),o("div",ca,[e[27]||(e[27]=o("div",{class:"text-subtitle2 q-mb-sm"},"Imagen Principal",-1)),o("div",ma,[i.main_image?(p(),b("div",ga,[o("img",{src:L(i.main_image),alt:"Imagen principal",class:"preview-image"},null,8,pa),n.value!=="view"?(p(),b("div",va,[t(y,{round:"",color:"negative",icon:"delete",size:"sm",onClick:ge})])):U("",!0)])):(p(),b("div",ya,[t(c,{name:"image",size:"3em",color:"grey-5"}),e[26]||(e[26]=o("div",{class:"text-grey-5"},"Sin imagen",-1))])),n.value!=="view"?(p(),Z(y,{key:2,color:"primary",icon:"upload",label:"Seleccionar Imagen",class:"q-mt-sm full-width",onClick:de})):U("",!0),o("input",{ref_key:"mainImageInput",ref:W,type:"file",accept:"image/*",style:{display:"none"},onChange:ce},null,544)])]),o("div",null,[e[28]||(e[28]=o("div",{class:"text-subtitle2 q-mb-sm"},"Galería (opcional)",-1)),o("div",fa,[(p(!0),b(Pe,null,Ie(i.gallery,(a,r)=>(p(),b("div",{key:r,class:"gallery-item"},[o("img",{src:L(a),alt:"Imagen de galería",class:"gallery-image"},null,8,ba),n.value!=="view"?(p(),b("div",_a,[t(y,{round:"",color:"negative",icon:"delete",size:"xs",onClick:v=>pe(r)},null,8,["onClick"])])):U("",!0)]))),128)),n.value!=="view"?(p(),b("div",wa,[t(y,{color:"primary",icon:"add",flat:"",class:"full-width full-height",onClick:ue})])):U("",!0)]),o("input",{ref_key:"galleryImageInput",ref:R,type:"file",accept:"image/*",multiple:"",style:{display:"none"},onChange:me},null,544)])])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Pa=xe(ha,[["__scopeId","data-v-aa19fe47"]]);export{Pa as default};
