import{ab as ye,r as v,S as Y,a as L,o as be,a8 as R,Z as N,a3 as o,$ as t,a0 as f,_ as s,a5 as x,a1 as _,a2 as g,ac as h,a4 as U,a6 as p,ad as Z,af as we,Y as J,ae as P,ai as _e,ag as K,ah as Q}from"./app-DPc9QzAE.js";import{Q as xe,a as Ce,b as F,c as j,e as W}from"./QSpace-CKcEZjQO.js";import{Q as X}from"./QForm-vz7GMIuE.js";import{u as he}from"./use-quasar-CDi9KkAc.js";import"./QList-mnSAHfSD.js";const Ue={class:"q-pa-lg"},Ve={class:"row items-center justify-between q-mb-xl"},qe={class:"col-auto"},ke={class:"text-subtitle2 text-grey-8 q-mb-md"},Ee={class:"row q-gutter-md"},$e={class:"col-md-4 col-sm-6 col-xs-12"},Qe={class:"col-md-3 col-sm-6 col-xs-12"},De={class:"col-auto"},Ie={class:"row q-gutter-md q-mb-lg"},Ne={class:"col"},je={class:"text-h6 text-primary"},ze={class:"col"},Ae={class:"text-h6 text-positive"},Le={class:"col"},Pe={class:"text-h6 text-negative"},Fe={class:"row items-center q-gutter-sm"},Se={class:"text-weight-medium"},Me={class:"text-caption text-grey-6"},Oe={class:"text-body2"},Te={class:"text-caption text-grey-6"},Be={class:"text-caption text-center q-mt-xs"},Re={class:"q-gutter-xs"},He={class:"full-width row flex-center text-grey-5 q-gutter-sm q-pa-lg"},Ge={class:"text-h5"},Ye={class:"row items-center q-gutter-sm"},Ze={key:2},Je={class:"row q-gutter-md"},Ke={class:"col"},We={class:"text-body2"},Xe={class:"col"},ea={class:"text-body2"},aa={key:3,class:"row q-gutter-sm justify-end q-mt-lg"},ta={class:"text-h6"},sa={class:"text-body1 q-mb-md"},oa={class:"row q-gutter-sm justify-end q-mt-lg"},la={__name:"AdminUsuarios",setup(ra){const y=he(),S=v(!1),z=v(!1),M=v(!1),d=v([]),A=v(!1),V=v(!1),m=v("create"),b=v(null),q=v(!1),D=v(!1),k=v(""),E=v(null),n=Y({name:"",email:"",password:"",password_confirmation:"",is_active:!0}),C=Y({password:"",password_confirmation:""}),$=v({sortBy:"created_at",descending:!0,page:1,rowsPerPage:10,rowsNumber:0}),ee=[{name:"user",label:"Usuario",field:"name",align:"left",sortable:!0,style:"width: 40%"},{name:"created_at",label:"Fecha de Registro",field:"created_at",align:"center",sortable:!0,style:"width: 20%"},{name:"status",label:"Estado",field:"is_active",align:"center",sortable:!0,style:"width: 15%"},{name:"actions",label:"Acciones",field:"actions",align:"center",sortable:!1,style:"width: 25%"}],ae=[{label:"Activos",value:1},{label:"Inactivos",value:0}],te=L(()=>{let l=[...d.value];if(k.value){const r=k.value.toLowerCase();l=l.filter(i=>{var u,w;return((u=i.name)==null?void 0:u.toLowerCase().includes(r))||((w=i.email)==null?void 0:w.toLowerCase().includes(r))})}E.value!==null&&(l=l.filter(r=>r.is_active===E.value));const e=($.value.page-1)*$.value.rowsPerPage,a=e+$.value.rowsPerPage;return $.value.rowsNumber=l.length,l.slice(e,a)}),se=L(()=>{switch(m.value){case"create":return"Nuevo Usuario";case"edit":return"Editar Usuario";case"view":return"Detalles del Usuario";default:return"Usuario"}}),oe=L(()=>d.value.filter(l=>l.is_active).length),le=L(()=>d.value.filter(l=>!l.is_active).length),re=async()=>{var l;S.value=!0;try{const e=await Q.get("/users");(l=e.data)!=null&&l.data?d.value=e.data.data:Array.isArray(e.data)?d.value=e.data:d.value=[]}catch(e){console.error("Error loading users:",e),d.value=[],y.notify({type:"negative",message:"Error al cargar los usuarios",icon:"error"})}finally{S.value=!1}},O=(l,e=null)=>{m.value=l,b.value=e,l==="create"?Object.assign(n,{name:"",email:"",password:"",password_confirmation:"",is_active:!0}):e&&Object.assign(n,{name:e.name||"",email:e.email||"",password:"",password_confirmation:"",is_active:e.is_active??!0}),A.value=!0},T=()=>{A.value=!1,b.value=null,z.value=!1,q.value=!1},ie=l=>{b.value=l,Object.assign(C,{password:"",password_confirmation:""}),V.value=!0},ne=async()=>{var l,e,a,r,i,u,w;z.value=!0;try{let c;if(m.value==="create")c=await Q.post("/users",n),(l=c.data)!=null&&l.data&&d.value.unshift(c.data.data);else if(m.value==="edit"&&b.value){const I={name:n.name,email:n.email,is_active:n.is_active};c=await Q.put(`/users/${b.value.id}`,I);const B=d.value.findIndex(ge=>ge.id===b.value.id);B!==-1&&((e=c.data)!=null&&e.data)&&(d.value[B]=c.data.data)}y.notify({type:"positive",message:((a=c.data)==null?void 0:a.message)||"Operación completada correctamente",icon:"check_circle"}),T()}catch(c){console.error("Error saving user:",c);let I="Error al guardar el usuario";(i=(r=c.response)==null?void 0:r.data)!=null&&i.message?I=c.response.data.message:(w=(u=c.response)==null?void 0:u.data)!=null&&w.errors&&(I=Object.values(c.response.data.errors).flat().join(", ")),y.notify({type:"negative",message:I,icon:"error"})}finally{z.value=!1}},de=async()=>{var l,e,a;M.value=!0;try{const r=await Q.put(`/users/${b.value.id}/change-password`,{password:C.password,password_confirmation:C.password_confirmation});y.notify({type:"positive",message:((l=r.data)==null?void 0:l.message)||"Contraseña actualizada correctamente",icon:"check_circle"}),V.value=!1}catch(r){console.error("Error changing password:",r);let i="Error al cambiar la contraseña";(a=(e=r.response)==null?void 0:e.data)!=null&&a.errors&&(i=Object.values(r.response.data.errors).flat().join(", ")),y.notify({type:"negative",message:i,icon:"error"})}finally{M.value=!1}},ue=async l=>{var e,a,r;l.updating=!0;try{const i=await Q.patch(`/users/${l.id}/toggle-active`),u=d.value.findIndex(w=>w.id===l.id);u!==-1&&(d.value[u].is_active=!d.value[u].is_active),y.notify({type:"positive",message:((e=i.data)==null?void 0:e.message)||"Estado actualizado correctamente",icon:"check_circle"})}catch(i){console.error("Error toggling user status:",i),y.notify({type:"negative",message:((r=(a=i.response)==null?void 0:a.data)==null?void 0:r.message)||"Error al cambiar el estado",icon:"error"})}finally{l.updating=!1}},ce=l=>{y.dialog({title:"Confirmar eliminación",message:`¿Estás seguro de eliminar el usuario "${l.name}"?`,cancel:!0,persistent:!0,ok:{label:"Eliminar",color:"negative",icon:"delete"},cancel:{label:"Cancelar",color:"grey",flat:!0}}).onOk(async()=>{var a,r,i;const e=y.notify({type:"ongoing",message:"Eliminando usuario...",timeout:0,spinner:!0});try{const u=await Q.delete(`/users/${l.id}`),w=d.value.findIndex(c=>c.id===l.id);w!==-1&&d.value.splice(w,1),e(),y.notify({type:"positive",message:((a=u.data)==null?void 0:a.message)||"Usuario eliminado correctamente",icon:"check_circle"})}catch(u){console.error("Error deleting user:",u),e(),y.notify({type:"negative",message:((i=(r=u.response)==null?void 0:r.data)==null?void 0:i.message)||"Error al eliminar el usuario",icon:"error"})}})},H=()=>{console.log("Filtros aplicados:",{search:k.value,status:E.value})},me=()=>{k.value="",E.value=null},ve=l=>{$.value=l.pagination},pe=l=>l?l.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"?",G=l=>l?new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"",fe=l=>{if(!l)return"";const e=new Date,a=new Date(l),r=Math.abs(e-a),i=Math.ceil(r/(1e3*60*60*24));return i===1?"Ayer":i<7?`Hace ${i} días`:i<30?`Hace ${Math.ceil(i/7)} semanas`:`Hace ${Math.ceil(i/30)} meses`};return be(async()=>{await re()}),(l,e)=>(N(),R("div",Ue,[o("div",Ve,[e[16]||(e[16]=o("div",{class:"col"},[o("div",{class:"text-h5 text-weight-light text-primary q-mb-sm"}," Gestión de Usuarioshsgdgd "),o("p",{class:"text-grey-6 text-body1"},"Administra los usuarios del sistema")],-1)),o("div",qe,[t(f,{color:"primary",icon:"bi-plus-circle",label:"Nuevo Usuario",unelevated:"",size:"md",class:"q-px-lg",onClick:e[0]||(e[0]=a=>O("create"))})])]),t(U,{flat:"",bordered:"",class:"q-mb-lg shadow-2"},{default:s(()=>[t(x,null,{default:s(()=>[o("div",ke,[t(g,{name:"bi-search",class:"q-mr-xs"}),e[17]||(e[17]=_(" Filtros de búsqueda "))]),o("div",Ee,[o("div",$e,[t(h,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=a=>k.value=a),placeholder:"Buscar por nombre o email...",outlined:"",dense:"",clearable:"",onInput:H},{prepend:s(()=>[t(g,{name:"bi-search",color:"primary"})]),_:1},8,["modelValue"])]),o("div",Qe,[t(xe,{modelValue:E.value,"onUpdate:modelValue":[e[2]||(e[2]=a=>E.value=a),H],options:ae,label:"Estado",outlined:"",dense:"",clearable:""},null,8,["modelValue"])]),o("div",De,[t(f,{flat:"",icon:"bi-x-circle",label:"Limpiar",color:"grey-7",onClick:me})])])]),_:1})]),_:1}),o("div",Ie,[o("div",Ne,[t(U,{flat:"",bordered:""},{default:s(()=>[t(x,{class:"text-center"},{default:s(()=>[o("div",je,p(d.value.length),1),e[18]||(e[18]=o("div",{class:"text-caption text-grey-6"},"Total Usuarios",-1))]),_:1,__:[18]})]),_:1})]),o("div",ze,[t(U,{flat:"",bordered:""},{default:s(()=>[t(x,{class:"text-center"},{default:s(()=>[o("div",Ae,p(oe.value),1),e[19]||(e[19]=o("div",{class:"text-caption text-grey-6"},"Usuarios Activos",-1))]),_:1,__:[19]})]),_:1})]),o("div",Le,[t(U,{flat:"",bordered:""},{default:s(()=>[t(x,{class:"text-center"},{default:s(()=>[o("div",Pe,p(le.value),1),e[20]||(e[20]=o("div",{class:"text-caption text-grey-6"},"Usuarios Inactivos",-1))]),_:1,__:[20]})]),_:1})])]),t(U,{flat:"",bordered:"",class:"shadow-2"},{default:s(()=>[t(x,null,{default:s(()=>[t(Ce,{rows:te.value,columns:ee,"row-key":"id",loading:S.value,flat:"",bordered:"",pagination:$.value,onRequest:ve,class:"user-table"},{"body-cell-user":s(a=>[t(F,{props:a},{default:s(()=>[o("div",Fe,[t(we,{size:"40px",color:"primary","text-color":"white",icon:"bi-person"},{default:s(()=>[_(p(pe(a.row.name)),1)]),_:2},1024),o("div",null,[o("div",Se,p(a.row.name),1),o("div",Me,p(a.row.email),1)])])]),_:2},1032,["props"])]),"body-cell-created_at":s(a=>[t(F,{props:a},{default:s(()=>[o("div",Oe,p(G(a.row.created_at)),1),o("div",Te,p(fe(a.row.created_at)),1)]),_:2},1032,["props"])]),"body-cell-status":s(a=>[t(F,{props:a},{default:s(()=>[t(Z,{"model-value":a.row.is_active,"onUpdate:modelValue":r=>ue(a.row),color:"positive",loading:a.row.updating,size:"lg"},null,8,["model-value","onUpdate:modelValue","loading"]),o("div",Be,p(a.row.is_active?"Activo":"Inactivo"),1)]),_:2},1032,["props"])]),"body-cell-actions":s(a=>[t(F,{props:a},{default:s(()=>[o("div",Re,[t(f,{flat:"",round:"",icon:"bi-eye",size:"sm",color:"info",onClick:r=>O("view",a.row)},{default:s(()=>[t(j,null,{default:s(()=>e[21]||(e[21]=[_("Ver detalles")])),_:1,__:[21]})]),_:2},1032,["onClick"]),t(f,{flat:"",round:"",icon:"bi-pencil",size:"sm",color:"primary",onClick:r=>O("edit",a.row)},{default:s(()=>[t(j,null,{default:s(()=>e[22]||(e[22]=[_("Editar")])),_:1,__:[22]})]),_:2},1032,["onClick"]),t(f,{flat:"",round:"",icon:"bi-key",size:"sm",color:"warning",onClick:r=>ie(a.row)},{default:s(()=>[t(j,null,{default:s(()=>e[23]||(e[23]=[_("Cambiar contraseña")])),_:1,__:[23]})]),_:2},1032,["onClick"]),t(f,{flat:"",round:"",icon:"bi-trash",size:"sm",color:"negative",onClick:r=>ce(a.row)},{default:s(()=>[t(j,null,{default:s(()=>e[24]||(e[24]=[_("Eliminar")])),_:1,__:[24]})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),"no-data":s(()=>[o("div",He,[t(g,{size:"3em",name:"bi-people"}),e[25]||(e[25]=o("div",{class:"text-center"},[o("div",{class:"text-h6"},"No se encontraron usuarios"),o("div",{class:"text-body2"},"Intenta ajustar los filtros o agrega un nuevo usuario")],-1))])]),_:1},8,["rows","loading","pagination"])]),_:1})]),_:1}),t(K,{modelValue:A.value,"onUpdate:modelValue":e[9]||(e[9]=a=>A.value=a),persistent:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:s(()=>[t(U,{class:"full-width",style:{"max-width":"600px"}},{default:s(()=>[t(x,{class:"row items-center q-pb-none bg-primary text-white"},{default:s(()=>[o("div",Ge,[t(g,{name:m.value==="create"?"bi-plus-circle":m.value==="edit"?"bi-pencil":"bi-eye",class:"q-mr-sm"},null,8,["name"]),_(" "+p(se.value),1)]),t(W),t(f,{icon:"bi-x",flat:"",round:"",dense:"",onClick:T})]),_:1}),t(x,{class:"q-pa-lg"},{default:s(()=>[t(X,{onSubmit:ne,class:"q-gutter-md"},{default:s(()=>[t(h,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=a=>n.name=a),label:"Nombre completo *",outlined:"",readonly:m.value==="view",rules:[a=>!!a||"El nombre es obligatorio"]},{prepend:s(()=>[t(g,{name:"bi-person"})]),_:1},8,["modelValue","readonly","rules"]),t(h,{modelValue:n.email,"onUpdate:modelValue":e[4]||(e[4]=a=>n.email=a),label:"Correo electrónico *",type:"email",outlined:"",readonly:m.value==="view",rules:[a=>!!a||"El email es obligatorio",a=>/.+@.+\..+/.test(a)||"Email inválido"]},{prepend:s(()=>[t(g,{name:"bi-envelope"})]),_:1},8,["modelValue","readonly","rules"]),m.value==="create"?(N(),J(h,{key:0,modelValue:n.password,"onUpdate:modelValue":e[6]||(e[6]=a=>n.password=a),label:"Contraseña *",type:q.value?"text":"password",outlined:"",rules:[a=>!!a||"La contraseña es obligatoria",a=>a.length>=8||"La contraseña debe tener al menos 8 caracteres"]},{prepend:s(()=>[t(g,{name:"bi-lock"})]),append:s(()=>[t(g,{name:q.value?"bi-eye-slash":"bi-eye",class:"cursor-pointer",onClick:e[5]||(e[5]=a=>q.value=!q.value)},null,8,["name"])]),_:1},8,["modelValue","type","rules"])):P("",!0),m.value==="create"?(N(),J(h,{key:1,modelValue:n.password_confirmation,"onUpdate:modelValue":e[7]||(e[7]=a=>n.password_confirmation=a),label:"Confirmar contraseña *",type:q.value?"text":"password",outlined:"",rules:[a=>!!a||"Confirma la contraseña",a=>a===n.password||"Las contraseñas no coinciden"]},{prepend:s(()=>[t(g,{name:"bi-lock"})]),_:1},8,["modelValue","type","rules"])):P("",!0),o("div",Ye,[t(Z,{modelValue:n.is_active,"onUpdate:modelValue":e[8]||(e[8]=a=>n.is_active=a),label:"Usuario activo",disable:m.value==="view",color:"positive"},null,8,["modelValue","disable"]),t(g,{name:"bi-question-circle",color:"grey-6",size:"sm"},{default:s(()=>[t(j,null,{default:s(()=>e[26]||(e[26]=[_("Los usuarios inactivos no pueden iniciar sesión")])),_:1,__:[26]})]),_:1})]),m.value==="view"&&b.value?(N(),R("div",Ze,[t(_e,{class:"q-my-md"}),e[29]||(e[29]=o("div",{class:"text-subtitle2 text-grey-8 q-mb-sm"},"Información adicional",-1)),o("div",Je,[o("div",Ke,[e[27]||(e[27]=o("div",{class:"text-caption text-grey-6"},"Usuario ID",-1)),o("div",We,"#"+p(b.value.id),1)]),o("div",Xe,[e[28]||(e[28]=o("div",{class:"text-caption text-grey-6"},"Registrado",-1)),o("div",ea,p(G(b.value.created_at)),1)])])])):P("",!0),m.value!=="view"?(N(),R("div",aa,[t(f,{flat:"",label:"Cancelar",color:"grey-7",onClick:T}),t(f,{type:"submit",label:m.value==="create"?"Crear Usuario":"Actualizar Usuario",color:"primary",loading:z.value,"icon-right":"save"},null,8,["label","loading"])])):P("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(K,{modelValue:V.value,"onUpdate:modelValue":e[15]||(e[15]=a=>V.value=a),persistent:""},{default:s(()=>[t(U,{style:{"min-width":"400px"}},{default:s(()=>[t(x,{class:"row items-center q-pb-none bg-warning text-white"},{default:s(()=>[o("div",ta,[t(g,{name:"bi-key",class:"q-mr-sm"}),e[30]||(e[30]=_(" Cambiar Contraseña "))]),t(W),t(f,{icon:"bi-x",flat:"",round:"",dense:"",onClick:e[10]||(e[10]=a=>V.value=!1)})]),_:1}),t(x,null,{default:s(()=>{var a;return[o("div",sa,[e[31]||(e[31]=_(" Cambiar contraseña para: ")),o("strong",null,p((a=b.value)==null?void 0:a.name),1)]),t(X,{onSubmit:de,class:"q-gutter-md"},{default:s(()=>[t(h,{modelValue:C.password,"onUpdate:modelValue":e[12]||(e[12]=r=>C.password=r),label:"Nueva contraseña *",type:D.value?"text":"password",outlined:"",rules:[r=>!!r||"La contraseña es obligatoria",r=>r.length>=8||"La contraseña debe tener al menos 8 caracteres"]},{append:s(()=>[t(g,{name:D.value?"bi-eye-slash":"bi-eye",class:"cursor-pointer",onClick:e[11]||(e[11]=r=>D.value=!D.value)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),t(h,{modelValue:C.password_confirmation,"onUpdate:modelValue":e[13]||(e[13]=r=>C.password_confirmation=r),label:"Confirmar nueva contraseña *",type:D.value?"text":"password",outlined:"",rules:[r=>!!r||"Confirma la contraseña",r=>r===C.password||"Las contraseñas no coinciden"]},null,8,["modelValue","type","rules"]),o("div",oa,[t(f,{flat:"",label:"Cancelar",color:"grey-7",onClick:e[14]||(e[14]=r=>V.value=!1)}),t(f,{type:"submit",label:"Cambiar Contraseña",color:"warning",loading:M.value,"icon-right":"key"},null,8,["loading"])])]),_:1})]}),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},ma=ye(la,[["__scopeId","data-v-880e0a32"]]);export{ma as default};
