# üóÑÔ∏è Documentaci√≥n de Base de Datos

## üìä Esquema General

El sistema utiliza **MySQL** como base de datos principal (`artesanias_store`), proporcionando robustez, escalabilidad y rendimiento √≥ptimo para el e-commerce. La estructura est√° dise√±ada para un e-commerce de artesan√≠as con las siguientes entidades principales:

## üìã Tablas y Relaciones

### Diagrama Entidad-Relaci√≥n

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   categories    ‚îÇ       ‚îÇ    products     ‚îÇ       ‚îÇ     orders      ‚îÇ
‚îÇ                 ‚îÇ       ‚îÇ                 ‚îÇ       ‚îÇ                 ‚îÇ
‚îÇ id (PK)         ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ id (PK)         ‚îÇ       ‚îÇ id (PK)         ‚îÇ
‚îÇ name            ‚îÇ      ‚îÇ‚îÇ name            ‚îÇ‚îÇ‚óÑ‚îÄ‚îÄ‚îê‚îÇ ‚îÇ cliente_id (FK) ‚îÇ
‚îÇ slug            ‚îÇ      ‚îî‚îÇ category_id (FK)‚îÇ       ‚îÇ order_number    ‚îÇ
‚îÇ description     ‚îÇ       ‚îÇ slug            ‚îÇ       ‚îÇ total_amount    ‚îÇ
‚îÇ image           ‚îÇ       ‚îÇ description     ‚îÇ       ‚îÇ status          ‚îÇ
‚îÇ is_active       ‚îÇ       ‚îÇ price           ‚îÇ       ‚îÇ items (JSON)    ‚îÇ
‚îÇ created_at      ‚îÇ       ‚îÇ stock           ‚îÇ       ‚îÇ customer_data   ‚îÇ
‚îÇ updated_at      ‚îÇ       ‚îÇ sku             ‚îÇ       ‚îÇ epayco_ref      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ dimensions      ‚îÇ       ‚îÇ created_at      ‚îÇ
                          ‚îÇ main_image      ‚îÇ       ‚îÇ updated_at      ‚îÇ
                          ‚îÇ gallery (JSON)  ‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ is_active       ‚îÇ               ‚îÇ
                          ‚îÇ created_at      ‚îÇ               ‚îÇ
                          ‚îÇ updated_at      ‚îÇ               ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
                                                            ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ     users       ‚îÇ       ‚îÇ    clientes     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ                 ‚îÇ       ‚îÇ                 ‚îÇ
‚îÇ id (PK)         ‚îÇ       ‚îÇ id (PK)         ‚îÇ
‚îÇ name            ‚îÇ       ‚îÇ nombre          ‚îÇ
‚îÇ email           ‚îÇ       ‚îÇ apellido        ‚îÇ
‚îÇ password        ‚îÇ       ‚îÇ tipo_documento  ‚îÇ
‚îÇ is_active       ‚îÇ       ‚îÇ numero_documento‚îÇ
‚îÇ created_at      ‚îÇ       ‚îÇ email           ‚îÇ
‚îÇ updated_at      ‚îÇ       ‚îÇ password        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ telefono        ‚îÇ
                          ‚îÇ fecha_nacimiento‚îÇ
                          ‚îÇ direccion       ‚îÇ
                          ‚îÇ ciudad          ‚îÇ
                          ‚îÇ departamento    ‚îÇ
                          ‚îÇ is_active       ‚îÇ
                          ‚îÇ created_at      ‚îÇ
                          ‚îÇ updated_at      ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìë Descripci√≥n Detallada de Tablas

### üè∑Ô∏è `categories`
Gestiona las categor√≠as de productos artesanales.

| Campo | Tipo | Descripci√≥n | Restricciones |
|-------|------|-------------|---------------|
| `id` | BIGINT | Clave primaria | AUTO_INCREMENT |
| `name` | VARCHAR(255) | Nombre de la categor√≠a | NOT NULL |
| `slug` | VARCHAR(255) | URL amigable | UNIQUE |
| `description` | TEXT | Descripci√≥n detallada | NULLABLE |
| `image` | VARCHAR(255) | Imagen representativa | NULLABLE |
| `is_active` | BOOLEAN | Estado activo/inactivo | DEFAULT TRUE |
| `created_at` | TIMESTAMP | Fecha de creaci√≥n | AUTO |
| `updated_at` | TIMESTAMP | Fecha de modificaci√≥n | AUTO |

**Relaciones:**
- `hasMany(Product::class)` - Una categor√≠a tiene muchos productos

---

### üé® `products`
Cat√°logo principal de artesan√≠as.

| Campo | Tipo | Descripci√≥n | Restricciones |
|-------|------|-------------|---------------|
| `id` | BIGINT | Clave primaria | AUTO_INCREMENT |
| `name` | VARCHAR(255) | Nombre del producto | NOT NULL |
| `slug` | VARCHAR(255) | URL amigable | UNIQUE |
| `description` | TEXT | Descripci√≥n detallada | NULLABLE |
| `price` | DECIMAL(10,2) | Precio en COP | NOT NULL |
| `stock` | INTEGER | Cantidad disponible | DEFAULT 0 |
| `sku` | VARCHAR(100) | C√≥digo √∫nico del producto | UNIQUE |
| `dimensions` | JSON | Dimensiones del producto | NULLABLE |
| `main_image` | VARCHAR(255) | Imagen principal | NULLABLE |
| `gallery` | JSON | Galer√≠a de im√°genes | NULLABLE |
| `is_active` | BOOLEAN | Estado activo/inactivo | DEFAULT TRUE |
| `category_id` | BIGINT | Categor√≠a del producto | FOREIGN KEY |
| `created_at` | TIMESTAMP | Fecha de creaci√≥n | AUTO |
| `updated_at` | TIMESTAMP | Fecha de modificaci√≥n | AUTO |

**Relaciones:**
- `belongsTo(Category::class)` - Un producto pertenece a una categor√≠a

**Casts:**
```php
'dimensions' => 'array',
'gallery' => 'array',
'is_active' => 'boolean'
```

---

### üë• `clientes`
Registro de clientes de la tienda.

| Campo | Tipo | Descripci√≥n | Restricciones |
|-------|------|-------------|---------------|
| `id` | BIGINT | Clave primaria | AUTO_INCREMENT |
| `nombre` | VARCHAR(255) | Nombre del cliente | NOT NULL |
| `apellido` | VARCHAR(255) | Apellido del cliente | NOT NULL |
| `tipo_documento` | ENUM | Tipo de documento | CC, CE, NIT, PP |
| `numero_documento` | VARCHAR(20) | N√∫mero de documento | UNIQUE |
| `email` | VARCHAR(255) | Correo electr√≥nico | UNIQUE, NOT NULL |
| `password` | VARCHAR(255) | Contrase√±a hasheada | NOT NULL |
| `telefono` | VARCHAR(20) | N√∫mero de tel√©fono | NULLABLE |
| `fecha_nacimiento` | DATE | Fecha de nacimiento | NULLABLE |
| `direccion` | TEXT | Direcci√≥n completa | NULLABLE |
| `ciudad` | VARCHAR(100) | Ciudad de residencia | NULLABLE |
| `departamento` | VARCHAR(100) | Departamento | NULLABLE |
| `is_active` | BOOLEAN | Estado activo/inactivo | DEFAULT TRUE |
| `email_verified_at` | TIMESTAMP | Verificaci√≥n de email | NULLABLE |
| `remember_token` | VARCHAR(100) | Token de recordar sesi√≥n | NULLABLE |
| `created_at` | TIMESTAMP | Fecha de registro | AUTO |
| `updated_at` | TIMESTAMP | Fecha de modificaci√≥n | AUTO |

**Relaciones:**
- `hasMany(Order::class)` - Un cliente puede tener muchos pedidos

**M√©todos Personalizados:**
- `getFullNameAttribute()` - Retorna nombre completo
- `getFormattedDocumentAttribute()` - Retorna documento formateado

**Autenticaci√≥n:**
- Implementa `HasApiTokens` para Sanctum
- Campo de identificaci√≥n: `email`

---

### üì¶ `orders`
Gesti√≥n de pedidos y transacciones.

| Campo | Tipo | Descripci√≥n | Restricciones |
|-------|------|-------------|---------------|
| `id` | BIGINT | Clave primaria | AUTO_INCREMENT |
| `cliente_id` | BIGINT | Cliente del pedido | FOREIGN KEY |
| `order_number` | VARCHAR(50) | N√∫mero √∫nico de pedido | UNIQUE |
| `total_amount` | DECIMAL(10,2) | Monto total | NOT NULL |
| `status` | ENUM | Estado del pedido | pending, paid, failed, cancelled |
| `items` | JSON | Productos del pedido | NOT NULL |
| `customer_data` | JSON | Datos del cliente | NULLABLE |
| `epayco_ref` | VARCHAR(255) | Referencia de ePayco | NULLABLE |
| `epayco_transaction_id` | VARCHAR(255) | ID de transacci√≥n | NULLABLE |
| `payment_method` | VARCHAR(50) | M√©todo de pago | NULLABLE |
| `notes` | TEXT | Notas adicionales | NULLABLE |
| `created_at` | TIMESTAMP | Fecha de creaci√≥n | AUTO |
| `updated_at` | TIMESTAMP | Fecha de modificaci√≥n | AUTO |

**Relaciones:**
- `belongsTo(Cliente::class)` - Un pedido pertenece a un cliente

**Constantes de Estado:**
```php
const STATUS_PENDING = 'pending';
const STATUS_PAID = 'paid';
const STATUS_FAILED = 'failed';
const STATUS_CANCELLED = 'cancelled';
```

**M√©todos Personalizados:**
- `generateOrderNumber()` - Genera n√∫mero √∫nico de pedido
- `getFormattedStatusAttribute()` - Estado en espa√±ol
- `isPaid()` - Verifica si est√° pagado
- `isPending()` - Verifica si est√° pendiente

---

### üë®‚Äçüíº `users`
Usuarios administrativos del sistema.

| Campo | Tipo | Descripci√≥n | Restricciones |
|-------|------|-------------|---------------|
| `id` | BIGINT | Clave primaria | AUTO_INCREMENT |
| `name` | VARCHAR(255) | Nombre del usuario | NOT NULL |
| `email` | VARCHAR(255) | Correo electr√≥nico | UNIQUE, NOT NULL |
| `email_verified_at` | TIMESTAMP | Verificaci√≥n de email | NULLABLE |
| `password` | VARCHAR(255) | Contrase√±a hasheada | NOT NULL |
| `is_active` | BOOLEAN | Estado activo/inactivo | DEFAULT TRUE |
| `remember_token` | VARCHAR(100) | Token de recordar sesi√≥n | NULLABLE |
| `created_at` | TIMESTAMP | Fecha de creaci√≥n | AUTO |
| `updated_at` | TIMESTAMP | Fecha de modificaci√≥n | AUTO |

## üîß Migraciones Importantes

### Historial de Migraciones

1. **`create_users_table`** - Tabla de usuarios administrativos
2. **`create_cache_table`** - Sistema de cach√©
3. **`create_jobs_table`** - Sistema de colas
4. **`create_categories_table`** - Categor√≠as de productos
5. **`create_products_table`** - Cat√°logo de productos
6. **`create_clientes_table`** - Registro de clientes
7. **`create_personal_access_tokens_table`** - Tokens Sanctum
8. **`add_is_active_to_users_table`** - Campo de estado para usuarios
9. **`create_orders_table`** - Sistema de pedidos
10. **`add_is_active_to_clientes_table`** - Campo de estado para clientes
11. **`update_product_images_to_webp`** - Optimizaci√≥n de im√°genes

## üå± Seeders y Datos de Prueba

### Seeders Disponibles

1. **`AdminUserSeeder`** - Crea usuario administrador por defecto
2. **`CategorySeeder`** - Categor√≠as iniciales de artesan√≠as
3. **`ProductSeeder`** - Productos de ejemplo con im√°genes
4. **`Additional10ProductsSeeder`** - Productos adicionales

### Ejecutar Seeders
```bash
# Todos los seeders
php artisan db:seed

# Seeder espec√≠fico
php artisan db:seed --class=CategorySeeder
```

## üîç Consultas Comunes

### Productos Activos por Categor√≠a
```sql
SELECT p.*, c.name as category_name 
FROM products p 
JOIN categories c ON p.category_id = c.id 
WHERE p.is_active = 1 AND c.is_active = 1;
```

### Pedidos con Cliente
```sql
SELECT o.*, c.nombre, c.apellido, c.email 
FROM orders o 
JOIN clientes c ON o.cliente_id = c.id 
ORDER BY o.created_at DESC;
```

### Productos M√°s Vendidos
```sql
SELECT p.name, COUNT(*) as order_count
FROM products p
JOIN orders o ON JSON_SEARCH(o.items, 'one', p.id) IS NOT NULL
WHERE o.status = 'paid'
GROUP BY p.id, p.name
ORDER BY order_count DESC;
```

## üîê √çndices y Optimizaci√≥n

### √çndices Autom√°ticos
- Claves primarias (`id`)
- Claves for√°neas (`category_id`, `cliente_id`)
- Campos √∫nicos (`email`, `slug`, `sku`)

### √çndices Recomendados para Producci√≥n
```sql
CREATE INDEX idx_products_active ON products(is_active);
CREATE INDEX idx_orders_status ON orders(status);
CREATE INDEX idx_orders_created ON orders(created_at);
```

## üíæ Backup y Restauraci√≥n

### Crear Backup
```bash
# Backup completo de MySQL
mysqldump -u root -p artesanias_store > backup_$(date +%Y%m%d).sql

# Backup de tabla espec√≠fica
mysqldump -u root -p artesanias_store products > products_backup.sql

# Backup con estructura y datos
mysqldump -u root -p --routines --triggers artesanias_store > backup_completo.sql
```

### Restaurar Backup
```bash
# Restaurar desde backup
mysql -u root -p artesanias_store < backup_20240827.sql

# Crear base de datos y restaurar
mysql -u root -p -e "CREATE DATABASE artesanias_store;"
mysql -u root -p artesanias_store < backup_completo.sql
```

## üìà Consideraciones de Escalabilidad

### Para Crecimiento del Negocio
- **Optimizaci√≥n MySQL**: Configuraci√≥n avanzada de InnoDB
- **√çndices Adicionales**: Optimizaci√≥n de consultas frecuentes
- **Particionamiento**: Divisi√≥n de tablas grandes por fecha
- **R√©plicas de Lectura**: Para consultas de productos
- **Master-Slave**: Separaci√≥n de lecturas y escrituras

### Monitoreo Recomendado
- Tama√±o de base de datos
- Consultas lentas
- Uso de √≠ndices
- Bloqueos de tabla

Este esquema proporciona una base s√≥lida para un e-commerce de artesan√≠as con capacidad de crecimiento.